<script>
  async function loadAllData() {
    document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleString()}`;
    try {
      await loadPortfolio();
      await loadMarketData();
      await loadBTCDominance();
      await loadTechnicalAnalysis();
      await loadNews();
      await loadWhaleAlerts();
      await loadFearGreedIndex();
    } catch (error) {
      console.error("loadAllData error:", error);
    }
  }

  async function loadPortfolio() {
    const portfolio = [
      { symbol: 'AVAX', qty: 115.51, entry: 25.96, id: 'avalanche-2' },
      { symbol: 'INJ', qty: 130.07, entry: 15.345, id: 'injective-protocol' },
      { symbol: 'RENDER', qty: 215.624, entry: 4.63, id: 'render-token' },
      { symbol: 'ADX', qty: 9132, entry: 0.1095, id: 'adex' },
      { symbol: 'HBAR', qty: 3546.82, entry: 0.28164, id: 'hedera-hashgraph' }
    ];
    try {
      const ids = portfolio.map(p => p.id).join(',');
      const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`);
      const prices = await res.json();
      let html = '';
      portfolio.forEach(p => {
        const price = prices[p.id]?.usd;
        if (price === undefined) {
          html += `<div>${p.symbol}: ‚ö†Ô∏è Price not available</div>`;
          return;
        }
        const value = p.qty * price;
        const pnl = (price - p.entry) * p.qty;
        const pnlColor = pnl >= 0 ? 'limegreen' : 'red';
        html += `<div>${p.symbol}: ${p.qty} √ó $${price.toFixed(2)} = $${value.toFixed(2)} (P&L: <span style="color:${pnlColor}">$${pnl.toFixed(2)}</span>)</div>`;
      });
      document.getElementById('portfolioTracker').innerHTML = html;
    } catch (error) {
      console.error("Portfolio error:", error);
      document.getElementById('portfolioTracker').innerHTML = '‚ö†Ô∏è Failed to load portfolio.';
    }
  }

  async function loadMarketData() {
    const ids = ['bitcoin', 'ethereum', 'avalanche-2', 'injective-protocol', 'render-token', 'adex', 'hedera-hashgraph'];
    try {
      const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids.join(',')}&vs_currencies=usd&include_24hr_change=true`);
      const data = await res.json();
      let html = '';
      ids.forEach(id => {
        const coin = data[id];
        if (!coin || coin.usd === undefined) {
          html += `<div>${id.toUpperCase()}: ‚ö†Ô∏è Price unavailable</div>`;
          return;
        }
        const name = id.replace(/-/g, ' ').toUpperCase();
        const change = coin.usd_24h_change?.toFixed(2) ?? '0.00';
        html += `<div>${name}: $${coin.usd.toFixed(2)} (${change}%)</div>`;
      });
      document.getElementById('marketOverview').innerHTML = html;
    } catch (error) {
      console.error("Market data error:", error);
      document.getElementById('marketOverview').innerHTML = '‚ö†Ô∏è Failed to load market data.';
    }
  }

  async function loadBTCDominance() {
    try {
      const response = await fetch('https://api.coingecko.com/api/v3/global');
      const data = await response.json();
      const btcDom = data?.data?.market_cap_percentage?.btc ?? 0;
      document.getElementById('btcDominance').innerText = `BTC Dominance: ${btcDom.toFixed(2)}%`;
    } catch (error) {
      console.error("BTC dominance error:", error);
      document.getElementById('btcDominance').innerText = '‚ö†Ô∏è Failed to load BTC dominance.';
    }
  }

  async function loadTechnicalAnalysis() {
    document.getElementById('technicalAnalysis').innerText = 'RSI: 51.23 (Neutral), MACD: 0.87 (Bullish), SMA20: $42,500';
  }

  async function loadNews() {
    try {
      document.getElementById('cryptoNews').innerHTML = 'üü° Top 5 crypto news headlines will appear here (mocked)';
    } catch (error) {
      console.error("News error:", error);
      document.getElementById('cryptoNews').innerText = '‚ö†Ô∏è Failed to load news.';
    }
  }

  async function loadWhaleAlerts() {
    try {
      document.getElementById('whaleAlerts').innerText = 'üü° 1,000 BTC moved to Binance - 2 hours ago';
    } catch (error) {
      console.error("Whale alert error:", error);
      document.getElementById('whaleAlerts').innerText = '‚ö†Ô∏è Failed to load whale alerts.';
    }
  }

  async function loadFearGreedIndex() {
    try {
      const response = await fetch('https://api.alternative.me/fng/');
      const data = await response.json();
      const index = data?.data?.[0];
      document.getElementById('fearGreedIndex').innerText = `Index: ${index?.value} (${index?.value_classification})`;
    } catch (error) {
      console.error("Fear & Greed error:", error);
      document.getElementById('fearGreedIndex').innerText = '‚ö†Ô∏è Failed to load sentiment.';
    }
  }

  loadAllData();
</script>
