<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crypto Dashboard</title>
  <style>
    body {
      background-color: #111122;
      color: white;
      font-family: monospace;
      padding: 20px;
    }
    .section {
      background-color: #1a1a2e;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .section h2 {
      color: orange;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 24px;
      margin-bottom: 10px;
    }
    .divider {
      height: 2px;
      background-color: orange;
      margin: 10px 0 20px;
    }
    .coin-line {
      display: flex;
      justify-content: space-between;
      white-space: pre;
    }
    .positive {
      color: #00ff88;
    }
    .negative {
      color: #ff5555;
    }
  </style>
</head>
<body>
  <div class="section">
    <h2>ðŸ’¼ Your Portfolio</h2>
    <div class="divider"></div>
    <div id="portfolio"></div>
  </div>

  <div class="section">
    <h2>ðŸ“Š Market Overview</h2>
    <div class="divider"></div>
    <div id="market-overview"></div>
  </div>

  <div class="section">
    <h2>ðŸ‘‘ BTC Dominance</h2>
    <div class="divider"></div>
    <div id="btc-dominance"></div>
    <p style="margin-top:10px; font-size: 14px; color: gray;">Source: CoinGecko</p>
  </div>

  <div class="section">
    <h2>ðŸ“° Latest Crypto News</h2>
    <div class="divider"></div>
    <ul id="crypto-news"></ul>
  </div>

  <div class="section">
    <h2>ðŸ˜± Fear & Greed Index</h2>
    <div class="divider"></div>
    <div id="fear-greed"></div>
  </div>

  <script>
    const holdings = {
      AVAX: { amount: 115.51, buyPrice: 26.8 },
      INJ: { amount: 130.07, buyPrice: 14.37 },
      RENDER: { amount: 215.624, buyPrice: 4.63 },
      ADX: { amount: 9132, buyPrice: 0.12 },
      HBAR: { amount: 3546.82, buyPrice: 0.28 }
    };

    async function fetchPrices() {
      const ids = "avalanche-2,injective-protocol,render-token,adex,hedera-hashgraph,bitcoin,ethereum";
      const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`;
      const res = await fetch(url);
      return res.json();
    }

    async function loadAllData() {
      const prices = await fetchPrices();
      const market = document.getElementById("market-overview");
      const portfolio = document.getElementById("portfolio");
      const btcDom = document.getElementById("btc-dominance");
      const fg = document.getElementById("fear-greed");

      let totalPNL = 0;
      portfolio.innerHTML = "";
      for (const [coin, data] of Object.entries(holdings)) {
        const id = getCoinGeckoId(coin);
        const price = prices[id]?.usd || 0;
        const currentValue = data.amount * price;
        const buyValue = data.amount * data.buyPrice;
        const pnl = currentValue - buyValue;
        totalPNL += pnl;
        portfolio.innerHTML += `
          <div class="coin-line">
            ${coin.padEnd(6)}: ${String(data.amount).padEnd(8)} Ã— $${price.toFixed(2).padEnd(6)} = $${currentValue.toFixed(2).padEnd(10)} 
            (P&L: <span class="${pnl >= 0 ? 'positive' : 'negative'}">$${pnl.toFixed(2)}</span>)
          </div>`;
      }
      portfolio.innerHTML += `
        <div class="coin-line" style="margin-top:10px;">
          Total P&L: <span class="${totalPNL >= 0 ? 'positive' : 'negative'}">$${totalPNL.toFixed(2)}</span>
        </div>`;

      market.innerHTML = "";
      for (const [id, data] of Object.entries(prices)) {
        const name = id.replace(/-/g, " ").toUpperCase();
        market.innerHTML += `
          <div class="coin-line">
            ${name.padEnd(20)}: $${data.usd.toFixed(2).padEnd(8)} (${data.usd_24h_change.toFixed(2)}%)
          </div>`;
      }

      // BTC Dominance
      const domData = await fetch("https://api.coingecko.com/api/v3/global").then(r => r.json());
      const dominance = domData.data.market_cap_percentage.btc.toFixed(2);
      btcDom.textContent = `BTC Dominance: ${dominance}%`;

      // Fear and Greed Index
      const fgData = await fetch("https://api.alternative.me/fng/").then(r => r.json());
      const fgVal = fgData.data[0];
      fg.textContent = `Index: ${fgVal.value} (${fgVal.value_classification})`;

      // CryptoPanic News
      const newsContainer = document.getElementById("crypto-news");
      const newsData = await fetch("https://cryptopanic.com/api/v1/posts/?auth_token=879a594ba23a5e397637a78effca34a3d5b702b0&public=true").then(r => r.json());
      newsContainer.innerHTML = newsData.results.slice(0, 5).map(n => `
        <li style="margin-bottom: 8px;">
          <a href="${n.url}" target="_blank" style="color: lightblue;">${n.title}</a>
        </li>`).join('');
    }

    function getCoinGeckoId(symbol) {
      const map = {
        AVAX: "avalanche-2",
        INJ: "injective-protocol",
        RENDER: "render-token",
        ADX: "adex",
        HBAR: "hedera-hashgraph",
        BTC: "bitcoin",
        ETH: "ethereum"
      };
      return map[symbol];
    }

    loadAllData();
    setInterval(loadAllData, 60000); // Refresh every 1 min
  </script>
</body>
</html>
