<script>
  async function loadAllData() {
    document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleString()}`;
    loadPortfolio();
    loadMarketData();
    loadBTCDominance();
    loadTechnicalAnalysis();
    loadNews();
    loadWhaleAlerts();
    loadFearGreedIndex();
  }

  async function loadPortfolio() {
    const portfolio = [
      { symbol: 'AVAX', qty: 115.51, entry: 25.96, id: 'avalanche-2' },
      { symbol: 'INJ', qty: 130.07, entry: 15.345, id: 'injective-protocol' },
      { symbol: 'RENDER', qty: 215.624, entry: 4.63, id: 'render-token' },
      { symbol: 'ADX', qty: 9132, entry: 0.1095, id: 'adex' },
      { symbol: 'HBAR', qty: 3546.82, entry: 0.28164, id: 'hedera-hashgraph' }
    ];

    const ids = portfolio.map(p => p.id).join(',');
    const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`);
    const prices = await res.json();

    let html = '';
    portfolio.forEach(p => {
      const live = prices[p.id]?.usd ?? 0;
      const value = p.qty * live;
      const pnl = (live - p.entry) * p.qty;
      const pnlColor = pnl >= 0 ? 'limegreen' : 'red';
      html += `<div>${p.symbol}: ${p.qty} Ã— $${live.toFixed(2)} = $${value.toFixed(2)} (P&L: <span style="color:${pnlColor}">$${pnl.toFixed(2)}</span>)</div>`;
    });

    document.getElementById('portfolioTracker').innerHTML = html;
  }

  async function loadMarketData() {
    const ids = ['bitcoin', 'ethereum', 'avalanche-2', 'injective-protocol', 'render-token', 'adex', 'hedera-hashgraph'].join(',');
    const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`);
    const data = await res.json();

    let html = '';
    for (const id in data) {
      const price = data[id].usd;
      const change = data[id].usd_24h_change;
      html += `<div>${id.toUpperCase()}: $${price} (${change.toFixed(2)}%)</div>`;
    }

    document.getElementById('marketOverview').innerHTML = html;
  }

  async function loadBTCDominance() {
    const response = await fetch('https://api.coingecko.com/api/v3/global');
    const data = await response.json();
    const btcDom = data.data.market_cap_percentage.btc;
    document.getElementById('btcDominance').innerText = `BTC Dominance: ${btcDom.toFixed(2)}%`;
  }

  async function loadTechnicalAnalysis() {
    document.getElementById('technicalAnalysis').innerText = 'RSI: 51.23 (Neutral), MACD: 0.87 (Bullish), SMA20: $42,500';
  }

  async function loadNews() {
    document.getElementById('cryptoNews').innerHTML = 'ðŸŸ¡ Top 5 crypto news headlines will appear here (mocked)';
  }

  async function loadWhaleAlerts() {
    document.getElementById('whaleAlerts').innerText = 'ðŸŸ¡ 1,000 BTC moved to Binance - 2 hours ago';
  }

  async function loadFearGreedIndex() {
    const response = await fetch('https://api.alternative.me/fng/');
    const data = await response.json();
    const index = data.data[0];
    document.getElementById('fearGreedIndex').innerText = `Index: ${index.value} (${index.value_classification})`;
  }

  loadAllData();
</script>
